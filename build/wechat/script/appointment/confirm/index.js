!function t(e,a,o){function r(n,i){if(!a[n]){if(!e[n]){var l="function"==typeof require&&require;if(!i&&l)return l(n,!0);if(d)return d(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=a[n]={exports:{}};e[n][0].call(s.exports,function(t){var a=e[n][1][t];return r(a?a:t)},s,s.exports,t,e,a,o)}return a[n].exports}for(var d="function"==typeof require&&require,n=0;n<o.length;n++)r(o[n]);return r}({1:[function(t,e,a){!function(){var t,e,a,o=TaoGu.APP.Utility,r=o.Network.queryString("hospId")||"",d=o.Network.queryString("deptId")||"",n=o.Network.queryString("doctorId")||"",i=o.Network.queryString("date")||"",l=o.Network.queryString("ampmType")||"",s=o.Network.queryString("timeSlot")||"",u=s.split("-")[0],p=s.split("-")[1],c=o.Network.queryString("resourceId")||"",m="",f=(o.Network.queryString("feeUnit")||"",""),b=o.Network.queryString("regAmt")||"",v=(o.Network.queryString("numberType")||"",o.Network.queryString("hospitaName")||""),y=o.Network.queryString("departmentName")||"",I=o.Network.queryString("doctorName")||"",h=(o.Network.queryString("departmentAddr")||"",0),g=!0,C=!0,N=!1,q=!1,S=!1,k=function(){var o={baseInfor:function(){$('[data-role="baseInfo"]').html(["<li><span>就诊日期：</span>"+i+"</li>","<li><span>就诊时段：</span>"+s+"</li>","<li><span>医院：</span>"+v+"</li>","<li><span>科室：</span>"+y+"</li>","<li><span>医生：</span>"+I+"</li>","<li><span>挂号费：</span> &yen; "+b+"元</li>"].join("")),t&&(S=!0,$('[data-role="patientName"]').html(t))},getPatientId:function(){$.ajax({url:"/order/getPatientId.htm",type:"POST",data:null,success:function(t){t.code||m||t.tmPId&&(m=t.tmPId,o.getPatientById())}})},treatcardFn:function(){$.ajax({url:"/treatcard/queryTreatCardByHosp.htm",type:"POST",data:{hospId:r,tmPId:m},success:function(t){t.code||($('[data-role="patientCard"]').html(t.pCardNo),t.pCardNo&&(q=!0,m&&q&&$('[data-role="telInput"]').val()&&$('[data-role="codeInput"]').val()?($('[data-role="submitButton"]').removeClass("disabled").removeAttr("disabled"),N=!0):($('[data-role="submitButton"]').addClass("disabled").attr("disabled",!0),N=!1))),1500==t.code&&(q=!1,$('[data-role="patientCard"]').text("请选择"))}})},hospitaDistance:function(){$.ajax({url:"/hospital/judgeHospitalDistance.htm",type:"POST",data:{hospId:r,longitude:null,latitude:null},success:function(t){50301==t.code&&promptUtil.alert({content:t.message,type:"alert"}),50302==t.code&&(h=t.judgeResult)}})},optionSubmit:function(t){$('[data-role="cancle-doing"]').removeClass("none"),$('[data-role="fade"]').removeClass("none").css("opacity","0.1"),C=!0;for(var e=0;e<$('[data-pay="paymentMethod"]').length;e++)$('[data-pay="paymentMethod"]').eq(e).hasClass("active")&&(f=$('[data-pay="paymentMethod"]').eq(e).find('[data-pay="paymentMethodInput"]').val());$.ajax({url:"/order/doOrderSubmit.htm",data:{hospId:r,deptId:d,doctorId:n,date:i,ampmType:l,timeStart:u,timeEnd:p,resourceId:c,patientId:m,pCardId:$('[data-role="patientCard"]').text(),regtAmt:b},type:"POST",success:function(t){t.code?promptUtil.alert({content:t.message,type:"confirm",calcelFunc:function(){N=!1,$('[data-role="submitButton"]').addClass("disabled").attr("disabled","disabled")},confirmFunc:function(){location.href="/wechat/html/doctor/home/?deptId="+d+"&doctorId="+n}}):t.returnUrl?location.href=t.returnUrl:location.href="/wechat/html/me/order/detail/?regtOrdId="+t.regtOrderID},complete:function(){C=!1,$('[data-role="cancle-doing"]').addClass("none"),$('[data-role="fade"]').addClass("none")}})},patientsPop:function(){$.ajax({url:"/familyMember/queryMyMembers.htm",data:null,type:"POST",success:function(t){if(t.code)1e3!=t.code&&promptUtil.alert({content:t.message,type:"alert"});else{S=!0,t.fmNumber<=0?$('[data-role="addpatientBtn"]').addClass("disabled").attr("data-disabled","disabled"):$('[data-role="addpatientBtn"]').removeClass("disabled").removeAttr("disabled"),!a&&!q&&$('[data-role="telInput"]').val()&&$('[data-role="codeInput"]').val()?($('[data-role="submitButton"]').removeClass("disabled").removeAttr("disabled"),N=!0):($('[data-role="submitButton"]').addClass("disabled").attr("disabled",!0),N=!1);var e=[];$.each(t.familflist,function(t,a){e.push('<li data-role="patientsLi" data-num="'+a.tmPId+'">'+a.pName+"</li>")}),$('[data-role="patientsListUl"]').html(e.join("")),$('[data-role="model"]').css({display:"block"}),$('[data-role="patientsList"]').css({display:"block"})}}})},countDown:function(){var t=$('[data-role="verificationCode"]').val(),e=59;$('[data-role="verificationCode"]').attr("disabled",!0).css("color","#484747");var a=setInterval(function(){e>=1?$('[data-role="verificationCode"]').val("重新获取 "+e--+"s"):($('[data-role="verificationCode"]').val(t).removeAttr("disabled"),clearInterval(a))},1e3)},inputRequired:function(){var t="";return t||taoguKit.valid.mobile($('[data-role="telInput"]').val())||(t="手机号格式有误"),t||taoguKit.valid.msgCode($('[data-role="codeInput"]').val())||(t="验证码格式有误"),!t||(promptUtil.toast(t),!1)},getPatientById:function(){$.ajax({url:"/familyMember/queryMemberInfo.htm",type:"POST",data:{patientId:m},success:function(a){t=a.pName,e=a.pCertNo,t?($('[data-role="patientName"]').html(t),m=m,S=!0,o.treatcardFn()):($('[data-role="patientName"]').text("请选择"),$('[data-role="patientCard"]').text("请选择"))}})}};return{init:function(){$('[data-role="codeInput"]').attr("disabled",!0).addClass("disabled").val(""),this.bindEve(),o.baseInfor(),o.hospitaDistance(),m?o.getPatientById():($('[data-role="patientName"]').text("请选择"),$('[data-role="patientCard"]').text("请选择"),o.getPatientId()),$('[data-role="telInput"]').val()&&$('[data-role="codeInput"]').val()&&$('[data-role="patientCard"]').text()&&"请选择"!=$('[data-role="patientCard"]').text()?($('[data-role="submitButton"]').removeClass("disabled").removeAttr("disabled"),N=!0):($('[data-role="submitButton"]').addClass("disabled").attr("disabled",!0),N=!1)},bindEve:function(){$('[data-role="verificationCode"]').on("click",function(){return $('[data-role="telInput"]').val().length?/^1\d{10}$/.test($('[data-role="telInput"]').val())?!!g&&void $.ajax({url:"/security/smscoderequest.htm",type:"POST",data:{phoneNo:$('[data-role="telInput"]').val(),type:4,patientId:m},success:function(t){t.code?promptUtil.alert({content:t.message,type:"alert"}):($('[data-role="codeInput"]').removeAttr("disabled").removeClass("disabled"),o.countDown())},complete:function(){g=!0}}):(promptUtil.toast("请输入正确的手机号"),!1):(promptUtil.toast("请输入手机号"),!1)}),$('[data-role="telInput"]').add($('[data-role="codeInput"]')).on("input",function(t){m&&q&&$('[data-role="telInput"]').val()&&$('[data-role="codeInput"]').val()?($('[data-role="submitButton"]').removeClass("disabled").removeAttr("disabled"),N=!0):($('[data-role="submitButton"]').addClass("disabled").attr("disabled",!0),N=!1)}),$('[data-role="submitButton"]').on("tap",function(){if(!o.inputRequired())return!1;if(!N)return!1;if(h){var t=$.trim($('[data-role="telInput"]').val()),e=$.trim($('[data-role="codeInput"]').val()),a=taoguKit.valid.getMsgCode(t,e);if(!a.ret)return promptUtil.alert({content:a.message,type:"alert"}),!1;o.optionSubmit()}else promptUtil.alert({content:"医院不允许预约",type:"alert"})}),$('[data-role="patientName"]').on("click",function(){o.patientsPop()}),$('[data-role="patientsListUl"]').on("click",'[data-role="patientsLi"]',function(){$('[data-role="patientName"]').html($(this).text()),m=$(this).data("num"),o.treatcardFn($(this).data("num")),S=!0,$('[data-role="model"]').css({display:"none"}),$('[data-role="patientsList"]').css({display:"none"})}),$('[data-role="patientCard"]').on("click",function(){S&&!q&&(location.href="/wechat/html/card/noCard/?patientId="+m+"&hospName="+v+"&hospId="+r+"&backto="+encodeURIComponent(location.href+"&patientId="+m))}),$('[data-role="addpatientBtn"]').on("tap",function(){"disabled"!=$(this).data("disabled")&&(location.href="/wechat/html/family/add/?backto="+encodeURIComponent(location.href+"&patientId="+m))})}}};k().init()}()},{}]},{},[1]);