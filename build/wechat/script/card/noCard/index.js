!function e(t,a,r){function d(n,i){if(!a[n]){if(!t[n]){var l="function"==typeof require&&require;if(!i&&l)return l(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=a[n]={exports:{}};t[n][0].call(s.exports,function(e){var a=t[n][1][e];return d(a?a:e)},s,s.exports,e,t,a,r)}return a[n].exports}for(var o="function"==typeof require&&require,n=0;n<r.length;n++)d(r[n]);return d}({1:[function(e,t,a){function r(){return b?($('[data-view="noCard"]').removeClass("none"),!1):void $.ajax({url:"/treatcard/queryCardsByHosp.htm",type:"POST",data:{hospId:u,memberId:m},success:function(e){e.code?1500==e.code?($('[data-view="noCard"]').removeClass("none"),$('[data-role="cardId"]').attr({placeholder:"",disabled:"true"}),d()):1e3!=e.code&&promptUtil.alert({content:e.message,type:"alert"}):(f=e.patientId,l=e.medicalCardFlag,$('[data-view="hasCard"]').removeClass("none"),$('[data-role="submit"]').removeClass("disabled").removeAttr("disabled"),C=e.medicalCardNo,$('span[data-role="cardId"]').text(e.medicalCardNo))}})}function d(){$.ajax({url:"/hospital/checkOnlineCard.htm",type:"POST",data:{hospId:u,memberId:m},success:function(e){e.code||1==e.map.lineFlag&&($('[data-role="online"]').removeClass("none"),$('[data-role="bindCardWays"]').removeClass("none"))}})}function o(e){wx&&wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(t){i=t.resultStr,e&&e(i)}})}function n(){$('[data-role="scan"]').on("click",function(){o(function(e){re=new RegExp(/^[0-9a-zA-Z]{0,20}$/),re.test(e)?($('input[data-role="cardId"]').val(e),$('[data-role="submit"]').removeClass("disabled").removeAttr("disabled")):promptUtil.alert({content:"就诊卡错误",type:"alert"})})}),$('[data-role="online"]').on("click",function(){location.href="/wechat/html/card/addOnline/?backto="+encodeURIComponent(c)+"&hospId="+u+"&hospName="+encodeURIComponent(p)+"&patientId="+m}),$('input[data-role="cardId"]').on("input",function(e){$.trim($(this).val()).length?$('[data-role="submit"]').removeClass("disabled").removeAttr("disabled"):$('[data-role="submit"]').addClass("disabled").attr("disabled",!0)}),$('[data-role="submit"]').on("click",function(){var e=!1,t="";return b&&(C=$.trim($('input[data-role="cardId"]').val()),$.ajax({url:"/treatcard/verifyTreatCardByHosp.htm",type:"POST",async:!1,data:{hospId:u,memberId:m,cardNo:C},success:function(a){a.code?t=a.message:(e=!0,l=a.medicalCardFlag,f=a.patientId)},error:function(){t="接口有误，稍后再试"}}),!e)?(promptUtil.alert({content:t,type:"alert"}),!1):void $.ajax({url:"/treatcard/bindTreateCard.htm",type:"POST",data:{hospId:u,memberId:m,patientId:f,medicalCardFlag:l,cardNo:C},success:function(e){e.code?promptUtil.alert({content:e.message,type:"alert"}):(promptUtil.alert({content:"添加诊疗卡成功",type:"alert"}),$('input[data-role="cardId"]').addClass("disabled").attr("disabled",!0),$('[data-role="submit"]').attr("disabled","disabled"),$('[data-role="submit"]').addClass("disabled"),promptUtil.alert({content:"添加成功",type:"alert"}))}})})}var i,l,s=TaoGu.APP.Utility,c=s.Network.queryString("backto"),u=s.Network.queryString("hospId"),p=s.Network.queryString("hospName"),m=s.Network.queryString("patientId"),f=s.Network.queryString("patientIdHis")||"",C="",b="EBAOWSGHGZYKDXDYFSYY000000000000"==u;b&&($('input[data-role="cardId"]').removeAttr("readonly"),$('[data-role="tipstext"]').text("若您已在医院办理诊疗卡,请在下方输入卡号").removeClass("none")),$('[data-role="hospName"]').text(p),r(),n()},{}]},{},[1]);