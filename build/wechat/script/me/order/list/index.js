!function e(t,a,r){function d(n,i){if(!a[n]){if(!t[n]){var s="function"==typeof require&&require;if(!i&&s)return s(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var l=a[n]={exports:{}};t[n][0].call(l.exports,function(e){var a=t[n][1][e];return d(a?a:e)},l,l.exports,e,t,a,r)}return a[n].exports}for(var o="function"==typeof require&&require,n=0;n<r.length;n++)d(r[n]);return d}({1:[function(e,t,a){var r=function(){var e=30,t=0,a=!0,r=!0,d="",o=!1,n=0,i=0,s={patientId:"",limits:{area:"",rules:{}},saleCountDown:function(e,t){if(!e||e<=0)return!1;var a=null,e=e;console.log(e),a=setInterval(function(){e-=1e3,e<=0&&($('[data-role="order-detial"]').eq(t).find('[data-role="gopay"]').hide(),$('[data-role="order-detial"]').eq(t).find('[data-role="cancel"]').hide(),$('[data-role="order-detial"]').find('[data-role="RegtCloseFlagName"]').text("预约失败"))},1e3)},patientList:function(){$.ajax({url:"/booking/queryMedicalMember.htm",type:"POST",data:{},success:function(e){e.code?1500==e.code?(this.render([]),o=!0,$('[data-role="noOrders"]').html(['<div class="no_result">','<img src="/wechat/images/no_screen.png" alt="您未通过本微信端进行过网络预约挂号" />',"</div>",'<div class="no_result_p">您未通过本微信端进行过网络预约挂号</div>'].join("")).show()):$('[data-role="noOrders"]').html(['<div class="no_result">','<img src="/wechat/images/no_screen.png" alt="您未通过本微信端进行过网络预约挂号" />',"</div>",'<div class="no_result_p">您未通过本微信端进行过网络预约挂号</div>'].join("")).show():(this.render(e.list),o=!1)}.bind(this)})},renderQuery:function(){$.ajax({url:"/data/queryDictList.htm",type:"POST",data:{},success:function(e){if(e.code)$('[data-role="noOrders"]').html(['<div class="no_result">','<img src="/wechat/images/no_screen.png" alt="您未通过本微信端进行过网络预约挂号" />',"</div>",'<div class="no_result_p">您未通过本微信端进行过网络预约挂号</div>'].join("")).show();else{var t=[],a=[];$.each(e.list,function(e,r){"PAY_FLAG_ID"==r.dictTypeId?t.push('<a href="javascript:;" data-id="'+r.dictId+'">'+r.dispName+"</a>"):a.push('<a href="javascript:;" data-id="'+r.dictId+'">'+r.dispName+"</a>")}),$('[data-role="wage"]').html(['<li style="height:auto;background:#fff;overflow:hidden;">',"<p>预约状态</p>",'<p class="level" data-role="rules" data-dom="d1">','<a id="d1" href="javascript:;" class="current" data-role="currentLevel">不限</a>'+a.join(""),"<p>支付状态</p>",'<p class="pad-b30 cata" data-role="rules" data-dom="d2">','<a id="d2" data-role="currentPad" href="javascript:;" class="current">不限</a>'+t.join(""),"</p>",'<div class="popup-btn"><span class="cz-btn" style="float:left"><a id="reset" href="javascript:;" data-role="reset">重置</a></span><span class="wc-btn" style="float:right;"><a id="finish" href="javascript:;" data-role="finish">完成</a></span></div>',"</li>"].join(""))}}})},render:function(e){e.length&&($('[data-role="mask"]').css("height",document.documentElement.clientHeight),this.buildLimit(e),this.buildList())},fetchData:function(t,a){var r={count:e,start:t*e};s.limits.area?r.tmPId=s.limits.area:"",s.limits.rules.d1?r.regtStatId=s.limits.rules.d1:"",s.limits.rules.d2?r.payStatId=s.limits.rules.d2:"",$.ajax({url:"/order/queryRecordList.htm",type:"POST",data:r,success:function(e){e.code||(n=e.sysTime,a(e.list),$('[data-role="hasOrders"]').show(),$('[data-role="noOrders"]').hide()),1500==e.code&&((r.tmPId||r.regtStatId||r.payStatId)&&$('[data-role="hasOrders"]').show(),$('[data-role="noOrders"]').html(['<div class="no_result">','<img src="/wechat/images/no_screen.png" alt="您未通过本微信端进行过网络预约挂号" />',"</div>",'<div class="no_result_p">'+(r.tmPId||r.payStatId||r.regtStatId?"无筛选结果":"您未通过本微信端进行过网络预约挂号")+"</div>"].join("")).show())}})},orderCancel:function(e){return!!a&&(a=!1,$('[data-role="cancle-doing"]').removeClass("none"),void $.ajax({url:"/order/cancleOrder.htm",type:"POST",data:{regtOrdId:e},success:function(e){e.code?promptUtil.alert({content:e.message,type:"alert"}):($('[data-role="cancle-doing"]').addClass("none"),$('[data-role="cancle-over"]').removeClass("none"),setTimeout(function(){$('[data-role="cancle-over"]').addClass("none")},3e3),location.reload())},complete:function(){$('[data-role="cancle-doing"]').addClass("none"),a=!1}}))},buildDataFunc:function(e,t){var a=[];return i=0,$.each(e,function(e,t){var r=t.payLockLongTime-n;a.push(['<li data-role="order-detial" data-regtOrdId="'+t.regtOrdId+'" data-href="regtOrdId='+t.regtOrdId+"&doSubmit="+encodeURIComponent(t.doSubmit)+"&cancleOrder="+encodeURIComponent(t.cancleOrder)+"&deptName="+encodeURIComponent(t.deptName)+'">',"<h2>"+t.hospName+"</h2>",'<div class="state" data-role="RegtCloseFlagName">'+(t.dispName||"")+"</div>"+function(){return t.RegtCloseFlagName?'<div class="state">'+(t.RegtCloseFlagName||"")+"</div>":""}(),"<h3>"+function(){var e=[];return t.deptName&&e.push(t.deptName),t.drLvlId&&e.push(t.drLvlId),t.drName&&e.push(t.drName),e.join("<span>|</span>")}()+"</h3>","<dl>","<dd>预约就诊时间："+(t.regtDate.substr(0,4)+"-"+t.regtDate.substr(4,2)+"-"+t.regtDate.substr(6,2))+" "+t.regtTimeStart+"</dd>","<dd>就诊人："+(t.pName||"")+"</dd>",'<dd class="'+(t.fullName?"":"none")+'">支付状态：'+t.fullName+"<span>￥"+(t.regtAmt||"")+"元</span></dd>","</dl>",'<div class="ordered_register_bottom">','<input type="button" value="再次预约" class="again" data-drType="'+t.drType+'" data-role="again" data-href="doctorId='+t.drId+"&deptId="+t.deptId+"&hospId="+t.hospId+"&deptName="+encodeURIComponent(t.deptName)+'"/>',function(){var e=[];return t.cancleOrder&&9!=t.regtStatId&&e.push('<input type="button" value="取消订单" class="cancel" data-role="cancel" />'),t.doSubmit&&9!=t.regtStatId&&e.push('<input type="button" value="立即支付" class="payment" data-role="gopay" />'),e.join("")}(),"</div>","</li>"].join("")),s.saleCountDown(r,i),++i}),a.join("")},buildLimit:function(e){var t=['<li class="current-correct">全部</li>'];$.each(e,function(e,a){t.push('<li data-v="'+a.tmPId+'">'+a.pName+"</li>")}),$('[data-role="area"]').html(t.join(""))},buildList:function(){$('[data-role="list"]').empty(),taoguKit.scrollLoad({wrapper:$('[data-role="list"]'),fetchDataFunc:this.fetchData,buildDataFunc:this.buildDataFunc,pageSize:e,currPage:t})},bindEvt:function(){$('[data-role="limit"]').on("click",function(e){return("limitArea"!=$(this).data("view")||!o)&&($(e.target).toggleClass("up"),void($(e.target).hasClass("up")?($('[data-screen="screen"]').hide(),$('[data-role="mask"]').show(),$(e.target).siblings().removeClass("up"),$('[data-role="'+$(e.target).attr("id")+'"]').show().siblings().hide()):($('[data-view="cont"]').hide(),$('[data-role="mask"]').hide())))});var e;$('[data-role="area"]').on("tap",function(t){e=e||$('[data-role="area"]>li').first(),e.removeClass("current-correct"),$("#area").text($(t.target).text()),this.limits.area=$(t.target).addClass("current-correct").data("v")||"",$('[data-role="limit"]').eq(0).toggleClass("up"),e=$(t.target),$('[data-role="area"]').hide(),$('[data-role="mask"]').hide(),this.buildList()}.bind(this)),$('[data-role="wage"]').on("click","a",function(e){$(e.target).addClass("current").siblings().removeClass("current"),this.limits.rules[$(e.target).closest('[data-role="rules"]').data("dom")]=$(e.target).attr("data-id")}.bind(this)),$('[data-role="wage"]').on("click",'[data-role="reset"]',function(e){$('[data-role="rules"] a').removeClass("current"),$('[data-role="currentLevel"]').addClass("current"),$('[data-role="currentPad"]').addClass("current"),this.limits.rules={}}.bind(this)),$('[data-role="wage"]').on("click",'[data-role="finish"]',function(e){$('[data-role="wage"]').hide(),$('[data-role="mask"]').hide(),$("#wage").removeClass("up"),this.buildList()}.bind(this)),$('[data-role="list"]').on("click",'[data-role="order-detial"]',function(e){return d=$(this).attr("data-regtOrdId"),$(e.target).closest('[data-role="again"]').length?0==$(e.target).data("drType")?(location.href="/wechat/html/doctor/home/?"+$(e.target).data("href"),!1):(location.href="/wechat/html/doctor/home/?"+$(e.target).data("href"),!1):$(e.target).closest('[data-role="cancel"]').length?($('[data-role="cancle_popup"]').removeClass("none"),$("#fade").show(),!1):$(e.target).closest('[data-role="gopay"]').length?!!r&&(r=!1,$.ajax({url:"/order/pay.htm",type:"POST",data:{regtOrdId:d},success:function(e){e.code?promptUtil.alert({content:e.message,type:"alert"}):location.href=e.returnUrl},complete:function(){r=!0}}),!1):void(location.href="/wechat/html/me/order/detail/?regtOrdId="+d)}),$('[data-role="sureBtn"]').on("tap",function(){$('[data-role="cancle_popup"]').addClass("none"),$("#fade").hide(),s.orderCancel(d)}),$('[data-role="cancerBtn"]').on("click",function(){$('[data-role="cancle_popup"]').addClass("none"),$("#fade").hide()})}};return{init:function(){s.patientList(),s.bindEvt(),s.renderQuery()}}}();r.init()},{}]},{},[1]);